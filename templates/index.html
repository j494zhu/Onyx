{% extends 'base.html' %} 

{% block content %}

    <div class="header-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>
            {% if readonly %}
                <span style="color: #2ecc71;">User: {{ display_user.username }} (Read Only)</span>
            {% else %}
                {{ current_user.username }}'s Log
            {% endif %}
        </h2>

        <div>
            {% if not readonly %}
                <a href="/history" style="text-decoration: none; color: #ffe494f8; font-weight: 600;">
                    View History
                </a>
                <!-- ÂÖ≥ÈîÆÂú®‰∫éË∞ÉÊï¥ height Âíå vertical-align -->
                <span style="margin: 0 15px; color: #ccc; border-left: 1px solid #ccc; height: 1em; display: inline-block; vertical-align: middle;"></span>
                <a href="/logout" style="color: #e74c3c; text-decoration: none; font-weight: 600;">
                    Logout
                </a>

            {% elif current_user.is_authenticated %}
                <a href="/logout" style="color: #e74c3c; text-decoration: none;">Logout</a>
            {% endif %}
        </div>
    </div>

    {% if not readonly %}
        <div style="background: rgba(183, 251, 151, 0.889); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px;">
            <h1 style="margin-top: 0; font-size: 1.2rem; color: #444;">Update your timeline</h1>
            
            <div class="form-container">
                <form action='/' method='POST'>
                    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Description:</label>
                    <input type="text" name="desc" placeholder="What did you do?" required style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px;">

                    <div class="time-inputs-wrapper">
                        <div class="time-field">
                            <label for="start_time">From</label>
                            <input type="time" id="start_time" name="start_time" required>
                        </div>
                        
                        <span class="time-separator">‚Üí</span>
                        
                        <div class="time-field">
                            <label for="end_time">To</label>
                            <input type="time" id="end_time" name="end_time" required>
                        </div>
                    </div>

                    <button type="submit" style="margin-top: 15px; width: 100%; padding: 10px; background-color: #48a95aee; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem;">
                        Add Item
                    </button>
                </form>
            </div>
        </div>
    {% endif %}

    
    <div style="background: rgba(183, 251, 151, 0.889); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px;">
        <h3 style="margin-top: 20px; color: #333;">History Flow</h3>
        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <thead style="background-color: #f8f9fa;">
                <tr>
                    <th width="5%" style="padding: 12px; text-align: left; border-bottom: 2px solid #eee;">#</th>
                    <th width="50%" style="padding: 12px; text-align: left; border-bottom: 2px solid #eee;">ÊèèËø∞</th>
                    <th width="15%" style="padding: 12px; text-align: left; border-bottom: 2px solid #eee;">ÂºÄÂßãÊó∂Èó¥</th>
                    <th width="15%" style="padding: 12px; text-align: left; border-bottom: 2px solid #eee;">ÁªìÊùüÊó∂Èó¥</th>
                    {% if not readonly %}
                        <th width="15%" style="padding: 12px; text-align: left; border-bottom: 2px solid #eee;">Êìç‰Ωú</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for item in expenses %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 12px;">{{ loop.index }}</td>
                    <td style="padding: 12px;">{{ item.desc }}</td>
                    <td style="padding: 12px;">{{ item.start_time }}</td> 
                    <td style="padding: 12px;">{{ item.end_time }}</td> 
                    
                    {% if not readonly %}
                    <td style="padding: 12px;">
                        <form action="/delete/{{ item.id }}" method="POST" style="margin:0;">
                            <button type="submit" class="delete-btn" style="color:#e74c3c; border:none; background:none; cursor:pointer; font-weight: bold;">
                                Delete
                            </button>
                        </form>
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
                
                {% if expenses|length == 0 %}
                <tr>
                    <td colspan="5" style="padding: 20px; text-align: center; color: #999;">
                        No records for today yet. 
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    

    {% if not readonly and expenses|length > 0 %}
        <div class="end-day-section" style="margin-top: 40px; margin-bottom: 60px; text-align: center; border-top: 2px dashed #eee; padding-top: 20px;">
            <p style="color: #888; font-size: 0.9em;">Ready to wrap up for the day?</p>
            <form action="/end_day" method="POST" onsubmit="return confirm('Are you sure you want to end this day? Current items will be archived.');">
                <button type="submit" style="background-color: #ff6b6b; color: white; border: none; padding: 12px 35px; border-radius: 30px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 6px rgba(255, 107, 107, 0.3); transition: transform 0.1s;">
                    üåô End Day & Archive
                </button>
            </form>
        </div>
    {% endif %}

{% endblock %}